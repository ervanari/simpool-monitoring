<%- include('../template/header') -%>
<%- include("../template/navside") -%>
<%- include("../template/navbars") -%>


<div class="container-fluid pt-3 pb-0 px-4">
	<div class="row">
		<div class="col-xl-2 col-sm-6 mb-xl-0 mb-4">
			<div class="card">
				<div class="p-3 pt-2">
					<div class="text-end pt-1">
						<p class="text-start text-sm mb-0 text-capitalize text-success font-weight-bolder">Port Active
						</p>
						<h4 class="text-end mb-0"> <%= active %> </h4>
					</div>
				</div>
			</div>
		</div>
		<div class="col-xl-2 col-sm-6 mb-xl-0 mb-4">
			<div class="card">
				<div class="p-3 pt-2">
					<div class="text-end pt-1">
						<p class="text-start text-sm mb-0 text-capitalize text-success font-weight-bolder">Port Off</p>
						<h4 class="mb-0"> <%= off %> </h4>
					</div>
				</div>
			</div>
		</div>
		<div class="col-xl-2 col-sm-6 mb-xl-0 mb-4">
			<div class="card">
				<div class="p-3 pt-2">
					<div class="text-end pt-1">
						<p class="text-start text-sm mb-0 text-capitalize text-success font-weight-bolder">Port Idle</p>
						<h4 class="mb-0"> <%= idle %> </h4>
					</div>
				</div>
			</div>
		</div>
		<div class="col-xl-2 col-sm-6 mb-xl-0 mb-4">
			<div class="card">
				<div class="p-3 pt-2">
					<div class="text-end pt-1">
						<p class="text-start text-sm mb-0 text-capitalize text-success font-weight-bolder">Port Booked
						</p>
						<h4 class="mb-0"> <%= booked %> </h4>
					</div>
				</div>
			</div>
		</div>
		<div class="col-xl-2 col-sm-6 mb-xl-0 mb-4">
			<div class="card">
				<div class="p-3 pt-2">
					<div class="text-end pt-1">
						<p class="text-start text-sm mb-0 text-capitalize text-success font-weight-bolder">Port Timeout
						</p>
						<h4 class="mb-0"> <%= timeout %> </h4>
					</div>
				</div>
			</div>
		</div>
		<div class="col-xl-2 col-sm-6 mb-xl-0 mb-4">
			<div class="card">
				<div class="p-3 pt-2">
					<div class="text-end pt-1">
						<form class="form-inline">
							<p class="text-start text-sm mb-0 text-capitalize text-success font-weight-bolder">Search
							</p>
							<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search"
								onkeydown="onSearch(event, '<%= dataDashboard %>')">
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container-fluid py-4">
	<div class="row">
		<% for(let i in dataDashboard) { %>
		<div class="col-xl-3 col-sm-6 mb-xl-0 mt-5">
			<div class="card" style="background-color: #333338;">
				<div class="card-header p-2 pt-2" style="background-color: #333338;">
					<% if(dataDashboard[i].isActive == true){ %>
					<div
						class="icon icon-lg icon-shape bg-success shadow-dark text-center border-radius-xl mt-n4 position-absolute">
						<i class="material-icons opacity-10">done</i>
					</div>
					<% } else { %>
					<div
						class="icon icon-lg icon-shape bg-danger shadow-dark text-center border-radius-xl mt-n4 position-absolute">
						<i class="material-icons opacity-10">close</i>
					</div>
					<% } %>

					<%  %>
					<div class="text-end pt-1">
						<p class="text-sm mb-0 text-capitalize font-weight-bolder" style="color: white;">
							<%= dataDashboard[i].simNumber%></p>
					</div>

					<% if(dataDashboard[i].isBooked == true){ %>
					<div class="d-flex justify-content-end">
						<div class="pt-1 pr-2">
							<i class="material-icons opacity-10">sync</i>
						</div>
						<div class="pt-1 pr-1">
							<p class="text-sm mb-0 text-capitalize font-weight-bolder" id="bookeds"
								style="color: white;">Booked</p>
						</div>
					</div>
					<% } else { %>
					<div class="d-flex justify-content-end">
						<div class="pt-1 pr-2">
							<i class="material-icons opacity-10">sync_disabled</i>
						</div>
						<div class="pt-1">
							<p class="text-sm mb-0 text-capitalize font-weight-bolder" id="bookeds"
								style="color: white;">Idle</p>
						</div>
					</div>
					<% } %>

					<% for(let j in dataPulsa) { %>
					<% if(dataDashboard[i].port === dataPulsa[j].deviceData[0].port){ %>
					<% if(dataPulsa[j].pulsa === undefined){ %>
					<div class="d-flex justify-content-center">
						<div class="text-center pt-1 small">
							IDR 0
						</div>
					</div>
					<% } else {%>
					<div class="d-flex justify-content-center">
						<div class="text-center pt-1 small" id="pulsa_data">
							IDR <%= dataPulsa[j].pulsa%>
						</div>
					</div>
					<% } %>
					<% } %>
					<% } %>

					<div class="d-flex justify-content-around">
						<div class="pt-1 small">
							IN
						</div>
						<div class="pt-1 small">
							OUT
						</div>
					</div>
					<%# for(let m in dataMutation) {%>
					<%# if(dataDashboard[i].simNumber == dataMutation[m].number){ %>
					<!-- <div class="row">
						<div class="pt-1 col-6 text-center small"> -->
					<%# dataMutation[m].in %>
					<!-- </div>
						<div class="pt-1 col-6 text-center small"> -->
					<%# dataMutation[m].out %>
					<!-- </div>
					</div> -->
					<%# } %>
					<%# } %>
				</div>

				<div class="d-flex">
					<% if(dataDashboard[i].isActive == true){ %>
					<div class="card-footer pt-1 px-2">
						<p class="mb-0"><span
								class="text-success text-sm font-weight-bolder"><%= dataDashboard[i].port %></p>
					</div>
					<% } else { %>
					<div class="card-footer pt-1 px-2">
						<p class="mb-0"><span class="text-danger text-sm font-weight-bolder"><%= dataDashboard[i].port%>
						</p>
					</div>
					<% } %>
					<button class="btn btn-lg text-start pt-1 icon-update"
						onclick="modalShow('renew');renew_pulsa('<%= dataDashboard[i].port %>')">
						<i class="material-icons opacity-10">perm_phone_msg</i>
					</button>
				</div>
				<div class="text-end mt-n3">
					<p class="text-center text-sm mb-0 text-capitalize font-weight-bolder" style="color: white;">
						<%= dataDashboard[i].simExp %> </p>
				</div>

				<button type="submit" class="btn btn-lg"
					onclick="modalShow('restart_sim');changeRestart('<%= dataDashboard[i].isActive %>', '<%= dataDashboard[i]._id %>', '<%= dataDashboard[i].deviceKey %>')">
					<% if(dataDashboard[i].isActive == true){ %>
					<span>
						Turn Off
					</span>
					<% } else { %>
					<span>
						Turn On
					</span>
					<% } %>
				</button>
			</div>
		</div>
		<% } %>
	</div>
</div>

<script>
	var socket = io('https://qz-pulsa.intama.online')
	socket.on('connect', function () {
		console.info('Socket connect');
	});
	socket.on('payment_completed::0f289dc7-c77a-48bc-abbc-82b389909c73', function (data) {
		console.log(data)
		// if (data != "") {
		// 	window.location.href = "/dashboard"
		// }
	});
	socket.on('pulsa_in::0f289dc7-c77a-48bc-abbc-82b389909c73', function (data) {
		console.log(data)
		// if (data != "") {
		// 	window.location.href = "/dashboard"
		// }
	});
	socket.on('device_update::0f289dc7-c77a-48bc-abbc-82b389909c73', function (data) {
		console.log(data)
		// if (data != "") {
		// 	window.location.href = "/dashboard"
		// }
	});
</script>
<%- include('../template/footer') -%>
<%- include("../modals/general_modals/modal_restart") -%>
<%- include("../modals/general_modals/modal_renew_pulsa") -%>