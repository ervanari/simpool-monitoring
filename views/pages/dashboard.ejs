<%- include('../template/header') -%>
<%- include("../template/navside") -%>
<%- include("../template/navbars") -%>

<div class="container-fluid py-4">
	<div class="row">
		<% for(let i in dataDashboard.devices) { %> 
			<div class="col-xl-3 col-sm-6 mb-xl-0 mt-5">
				<div class="card" style="background-color: #333338;">
					<div class="card-header p-2 pt-2" style="background-color: #333338;">
						<% if(dataDashboard.devices[i].isActive == true){ %>
							<div class="icon icon-lg icon-shape bg-success shadow-dark text-center border-radius-xl mt-n4 position-absolute">
								<i class="material-icons opacity-10">done</i>
							</div>
						<% } else { %>
							<div class="icon icon-lg icon-shape bg-danger shadow-dark text-center border-radius-xl mt-n4 position-absolute">
								<i class="material-icons opacity-10">close</i>
							</div>
						<% } %> 
						
						<div class="text-end pt-1">
							<p class="text-sm mb-0 text-capitalize font-weight-bolder" style="color: white;"><%= dataDashboard.devices[i].simNumber%></p>
						</div>

						<% if(dataDashboard.devices[i].isBooked == true){ %>
							<div class="d-flex justify-content-end">
								<div class="pt-1 pr-2">
									<i class="material-icons opacity-10">sync</i>
								</div>
								<div class="pt-1 pr-1">
									<p class="text-sm mb-0 text-capitalize font-weight-bolder" style="color: white;">Booked</p>
								</div>
							</div>
						<% } else { %>
							<div class="d-flex justify-content-end">
								<div class="pt-1 pr-2">
									<i class="material-icons opacity-10">sync_disabled</i>
								</div>
								<div class="pt-1">
									<p class="text-sm mb-0 text-capitalize font-weight-bolder" style="color: white;">Idle</p>
								</div>
							</div>
						<% } %> 
						
						<% for(let j in dataPulsa) { %> 
							<% if(dataDashboard.devices[i].port === dataPulsa[j].deviceData[0].port){ %>
								<% if(dataPulsa[j].pulsa == undefined){ %>
									<div class="d-flex justify-content-center">
										<div class="text-center pt-1 small">
											IDR 0
										</div>
									</div>
								<% } else {%> 
									<div class="d-flex justify-content-center">
										<div class="text-center pt-1 small">
											IDR <%= dataPulsa[j].pulsa%>
										</div>
									</div>
								<% } %> 
							<% } %> 
						<% } %> 

						<div class="d-flex justify-content-around">
							<div class="pt-1 small">
								IN 
							</div>
							<div class="pt-1 small">
								OUT 
							</div>
						</div>
						<% for(let m in dataMutation) {%> 
							<% if(dataDashboard.devices[i].simNumber == dataMutation[m].number){ %>
								<div class="row">
									<div class="pt-1 col-6 text-center small">
										IDR <%= dataMutation[m].in %> 
									</div>
									<div class="pt-1 col-6 text-center small">
										IDR <%= dataMutation[m].out %> 
									</div>
								</div>
							<% } %> 
						<% } %> 
					</div>

					<div class="d-flex">
						<% if(dataDashboard.devices[i].isActive == true){ %>
							<div class="card-footer pt-1 px-2">
								<p class="mb-0"><span class="text-success text-sm font-weight-bolder"><%= dataDashboard.devices[i].port %></p>
							</div>
						<% } else { %>
							<div class="card-footer pt-1 px-2">
								<p class="mb-0"><span class="text-danger text-sm font-weight-bolder"><%= dataDashboard.devices[i].port%></p>
							</div>
						<% } %> 
						<button class="btn btn-lg text-start pt-1 icon-update" onclick="modalShow('renew');renew_pulsa('<%= JSON.stringify(dataDashboard.devices[i].dial_message) %>')">
							<i class="material-icons opacity-10">perm_phone_msg</i>
						</button>
					</div>

					<button type="submit" class="btn btn-lg" onclick="modalShow('restart_sim');changeRestart('<%= dataDashboard.devices[i].isActive %>', '<%= dataDashboard.devices[i]._id %>', '<%= dataDashboard.devices[i].deviceKey %>')">
						<% if(dataDashboard.devices[i].isActive == true){ %>
							<span>
								Turn Off
							</span>
						<% } else { %>
							<span>
								Turn On
							</span>
						<% } %> 
					</button>
				</div>
			</div>
		<% } %> 
	</div>
</div>

<%- include('../template/footer') -%>
<%- include("../modals/general_modals/modal_restart") -%>
<%- include("../modals/general_modals/modal_renew_pulsa") -%>


